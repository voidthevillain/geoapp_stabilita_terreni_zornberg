import { Document, Packer, Paragraph, TextRun, Media, HorizontalPositionAlign, VerticalPositionAlign, HorizontalPositionRelativeFrom, VerticalPositionRelativeFrom, TextWrappingSide, TextWrappingType } from 'docx'
import { logo_print, scheme } from './base64.util'
import { y_terr, c_terr, phi, b, t_terr, l, lt, delta, t_nom, fs1, fs2, fs3, fs4, w } from './dom.util'
import { fs_tot, t_amm, tp, n, s, fsr } from './dom.util'
import { rad, sen, cos, tan } from './ang.util'

export const createDocument = () => {
  return (() => {
    const doc = new Document()

    doc.creator = 'Mihai Filip (GeoStru)',
    doc.description = 'Relazione generata dall\'app Stabilità del Terreno - Pendio Indefinito con Rinforzo',
    doc.title = 'Report'

    const headerImg = Media.addImage(doc, logo_print, 83, 25, {
      floating: {
        horizontalPosition: {
            relative: HorizontalPositionRelativeFrom.PAGE,
            align: HorizontalPositionAlign.CENTER,
        },
        verticalPosition: {
            relative: VerticalPositionRelativeFrom.TOP_MARGIN,
            align: VerticalPositionAlign.CENTER,
        }
    }})
    doc.Header.addImage(headerImg)

    const title = new Paragraph()
    const t_1 = new TextRun('Stabilità del Terreno').bold()
    title.addRun(t_1)
    doc.addParagraph(title.title().center())
    
    const subtitle = new Paragraph()
    const s_1 = new TextRun('Pendio Indefinito con Rinforzo').color('#6D6D6D')
    subtitle.addRun(s_1)
    doc.addParagraph(subtitle.heading2().center())

    const p1 = new Paragraph()
    const p1_1 = new TextRun(`L'applicazione consente di individuare il fattore di sicurezza associato alla stabiltà di un sistema di copertura geosintetica installato lungo un pendio indefinito. Esso è individuato dal rapporto tra le forze di attrito stabilizzanti e quelle instabilizzanti che tendono a indurre un movimento traslazionale verso il basso del terreno posto superiormente la copertura sintetica.`).size(24).break().break()
    p1.addRun(p1_1)
    doc.addParagraph(p1)

    const p2 = new Paragraph()
    const p2_1 = new TextRun(`L'algoritmo di calcolo prevede l'individuazione di un volume di controllo, lungo L, di spessore pari a T, sul quale vengono individuate le due componenti che costituiscono il FS ricercato.`).size(24).break()
    p2.addRun(p2_1)
    doc.addParagraph(p2)

    const schemeImg = Media.addImage(doc, scheme, 300, 257, {
      floating: {
        horizontalPosition: {
            relative: HorizontalPositionRelativeFrom.PAGE,
            align: HorizontalPositionAlign.CENTER,
        },
        verticalPosition: {
            relative: VerticalPositionRelativeFrom.LINE,
            align: VerticalPositionAlign.INSIDE,
        },
        wrap: {
          type: TextWrappingType.TOP_AND_BOTTOM,
          side: TextWrappingSide.BOTH_SIDES,
      }
    }
    })
    doc.addImage(schemeImg)

    if (typeof fs_tot === 'undefined' || typeof t_amm === 'undefined' || typeof tp === 'undefined' || typeof n === 'undefined' || typeof s === 'undefined' || typeof fsr === 'undefined') { // t_amm, tp, n, s, fsr
      const p3 = new Paragraph()
      const p3_1 = new TextRun('Non è stato effettuato il calcolo').bold().size(24).break()
      p3.addRun(p3_1)
      doc.addParagraph(p3.center())
    } else {
      const p3 = new Paragraph()
      const p3_1 = new TextRun('Dati').bold().size(24)
      p3.addRun(p3_1)
      doc.addParagraph(p3)

      const p4 = new Paragraph()
      const p4_1 = new TextRun('Dati relativi al terreno').bold().size(24)
      p4.addRun(p4_1)
      doc.addParagraph(p4)

      const p5 = new Paragraph()
      p5.rightTabStop(5536)
      p5.leftTabStop(5736)
      p5.rightTabStop(6636)
      p5.leftTabStop(6836)
      p5.rightTabStop(7736)
      p5.leftTabStop(7936)
      const p5_1 = new TextRun('Peso specifico del terreno di riporto').size(24)
      const p5_2 = new TextRun('γ').size(24).tab().tab().tab()
      const p5_2_1 = new TextRun('_terr').size(24).subScript()
      const p5_3 = new TextRun(y_terr.toFixed(2)).bold().size(24).tab().tab()
      const p5_4 = new TextRun('kN/m').size(24).tab()
      const p5_4_1 = new TextRun('3').size(24).superScript()
      p5.addRun(p5_1)
      p5.addRun(p5_2)
      p5.addRun(p5_2_1)
      p5.addRun(p5_3)
      p5.addRun(p5_4)
      p5.addRun(p5_4_1)
      doc.addParagraph(p5)

      const p6 = new Paragraph()
      p6.rightTabStop(5536)
      p6.leftTabStop(5736)
      p6.rightTabStop(6636)
      p6.leftTabStop(6836)
      p6.rightTabStop(7736)
      p6.leftTabStop(7936)
      const p6_1 = new TextRun('Coesione del terreno di riporto').size(24)
      const p6_2 = new TextRun('c').size(24).tab().tab().tab()
      const p6_2_1 = new TextRun('_terr').size(24).subScript()
      const p6_3 = new TextRun(c_terr.toFixed(2)).bold().size(24).tab().tab()
      const p6_4 = new TextRun('kPa').size(24).tab()
      p6.addRun(p6_1)
      p6.addRun(p6_2)
      p6.addRun(p6_2_1)
      p6.addRun(p6_3)
      p6.addRun(p6_4)
      doc.addParagraph(p6)

      const p7 = new Paragraph()
      p7.rightTabStop(5536)
      p7.leftTabStop(5736)
      p7.rightTabStop(6636)
      p7.leftTabStop(6836)
      p7.rightTabStop(7736)
      p7.leftTabStop(7936)
      const p7_1 = new TextRun('Angolo di attrito del terreno di riporto').size(24)
      const p7_2 = new TextRun('φ').size(24).tab().tab().tab()
      const p7_3 = new TextRun(phi.toFixed(2)).bold().size(24).tab().tab()
      const p7_4 = new TextRun('°').size(24).tab()
      p7.addRun(p7_1)
      p7.addRun(p7_2)
      p7.addRun(p7_3)
      p7.addRun(p7_4)
      doc.addParagraph(p7)

      const p8 = new Paragraph()
      p8.rightTabStop(5536)
      p8.leftTabStop(5736)
      p8.rightTabStop(6636)
      p8.leftTabStop(6836)
      p8.rightTabStop(7736)
      p8.leftTabStop(7936)
      const p8_1 = new TextRun('').size(24)
      const p8_2 = new TextRun('tan(φ)').size(24).tab().tab().tab()
      const p8_3 = new TextRun(tan(rad(phi)).toFixed(2)).bold().size(24).tab().tab()
      const p8_4 = new TextRun('').size(24).tab()
      p8.addRun(p8_1)
      p8.addRun(p8_2)
      p8.addRun(p8_3)
      p8.addRun(p8_4)
      doc.addParagraph(p8)

      const p9 = new Paragraph()
      p9.rightTabStop(5536)
      p9.leftTabStop(5736)
      p9.rightTabStop(6636)
      p9.leftTabStop(6836)
      p9.rightTabStop(7736)
      p9.leftTabStop(7936)
      const p9_1 = new TextRun('Peso del volume di controllo').size(24)
      const p9_2 = new TextRun('W').size(24).tab().tab().tab()
      const p9_3 = new TextRun(w.toFixed(2)).bold().size(24).tab().tab()
      const p9_4 = new TextRun('kN/m').size(24).tab()
      p9.addRun(p9_1)
      p9.addRun(p9_2)
      p9.addRun(p9_3)
      p9.addRun(p9_4)
      doc.addParagraph(p9)

      const p10 = new Paragraph()
      const p10_1 = new TextRun('Dati relativi alla geometria').bold().size(24).break()
      p10.addRun(p10_1)
      doc.addParagraph(p10)

      const p11 = new Paragraph()
      p11.rightTabStop(5536)
      p11.leftTabStop(5736)
      p11.rightTabStop(6636)
      p11.leftTabStop(6836)
      p11.rightTabStop(7736)
      p11.leftTabStop(7936)
      const p11_1 = new TextRun('Angolo di di inclinazione del pendio').size(24)
      const p11_2 = new TextRun('β').size(24).tab().tab().tab()
      const p11_3 = new TextRun(b.toFixed(2)).bold().size(24).tab().tab()
      const p11_4 = new TextRun('°').size(24).tab()
      p11.addRun(p11_1)
      p11.addRun(p11_2)
      p11.addRun(p11_3)
      p11.addRun(p11_4)
      doc.addParagraph(p11)

      const p12 = new Paragraph()
      p12.rightTabStop(5536)
      p12.leftTabStop(5736)
      p12.rightTabStop(6636)
      p12.leftTabStop(6836)
      p12.rightTabStop(7736)
      p12.leftTabStop(7936)
      const p12_1 = new TextRun('').size(24)
      const p12_2 = new TextRun('sen(β)').size(24).tab().tab().tab()
      const p12_3 = new TextRun(sen(rad(b)).toFixed(2)).bold().size(24).tab().tab()
      const p12_4 = new TextRun('').size(24).tab()
      p12.addRun(p12_1)
      p12.addRun(p12_2)
      p12.addRun(p12_3)
      p12.addRun(p12_4)
      doc.addParagraph(p12)

      const p13 = new Paragraph()
      p13.rightTabStop(5536)
      p13.leftTabStop(5736)
      p13.rightTabStop(6636)
      p13.leftTabStop(6836)
      p13.rightTabStop(7736)
      p13.leftTabStop(7936)
      const p13_1 = new TextRun('').size(24)
      const p13_2 = new TextRun('cos(β)').size(24).tab().tab().tab()
      const p13_3 = new TextRun(cos(rad(b)).toFixed(2)).bold().size(24).tab().tab()
      const p13_4 = new TextRun('').size(24).tab()
      p13.addRun(p13_1)
      p13.addRun(p13_2)
      p13.addRun(p13_3)
      p13.addRun(p13_4)
      doc.addParagraph(p13)

      const p14 = new Paragraph()
      p14.rightTabStop(5536)
      p14.leftTabStop(5736)
      p14.rightTabStop(6636)
      p14.leftTabStop(6836)
      p14.rightTabStop(7736)
      p14.leftTabStop(7936)
      const p14_1 = new TextRun('').size(24)
      const p14_2 = new TextRun('tan(β)').size(24).tab().tab().tab()
      const p14_3 = new TextRun(tan(rad(b)).toFixed(2)).bold().size(24).tab().tab()
      const p14_4 = new TextRun('').size(24).tab()
      p14.addRun(p14_1)
      p14.addRun(p14_2)
      p14.addRun(p14_3)
      p14.addRun(p14_4)
      doc.addParagraph(p14)

      const p15 = new Paragraph()
      p15.rightTabStop(5536)
      p15.leftTabStop(5736)
      p15.rightTabStop(6636)
      p15.leftTabStop(6836)
      p15.rightTabStop(7736)
      p15.leftTabStop(7936)
      const p15_1 = new TextRun('Spessore del terreno di riporto').size(24)
      const p15_2 = new TextRun('t').size(24).tab().tab().tab()
      const p15_2_1 = new TextRun('_terr').size(24).subScript()
      const p15_3 = new TextRun(t_terr.toFixed(2)).bold().size(24).tab().tab()
      const p15_4 = new TextRun('m').size(24).tab()
      p15.addRun(p15_1)
      p15.addRun(p15_2)
      p15.addRun(p15_2_1)
      p15.addRun(p15_3)
      p15.addRun(p15_4)
      doc.addParagraph(p15)

      const p16 = new Paragraph()
      p16.rightTabStop(5536)
      p16.leftTabStop(5736)
      p16.rightTabStop(6636)
      p16.leftTabStop(6836)
      p16.rightTabStop(7736)
      p16.leftTabStop(7936)
      const p16_1 = new TextRun('Lunghezza del volume di controllo').size(24)
      const p16_2 = new TextRun('L').size(24).tab().tab().tab()
      const p16_3 = new TextRun(l.toFixed(2)).bold().size(24).tab().tab()
      const p16_4 = new TextRun('m').size(24).tab()
      p16.addRun(p16_1)
      p16.addRun(p16_2)
      p16.addRun(p16_3)
      p16.addRun(p16_4)
      doc.addParagraph(p16)

      const p17 = new Paragraph()
      p17.rightTabStop(5536)
      p17.leftTabStop(5736)
      p17.rightTabStop(6636)
      p17.leftTabStop(6836)
      p17.rightTabStop(7736)
      p17.leftTabStop(7936)
      const p17_1 = new TextRun('Lunghezza della scarpata').size(24)
      const p17_2 = new TextRun('L').size(24).tab().tab().tab()
      const p17_2_1 = new TextRun('t').size(24).subScript()
      const p17_3 = new TextRun(lt.toFixed(2)).bold().size(24).tab().tab()
      const p17_4 = new TextRun('m').size(24).tab()
      p17.addRun(p17_1)
      p17.addRun(p17_2)
      p17.addRun(p17_2_1)
      p17.addRun(p17_3)
      p17.addRun(p17_4)
      doc.addParagraph(p17)

      const p18 = new Paragraph()
      const p18_1 = new TextRun('Dati relativi alle caratteristiche del rinforzo sintetico').bold().size(24).break()
      p18.addRun(p18_1)
      doc.addParagraph(p18)

      const p19 = new Paragraph()
      p19.rightTabStop(5536)
      p19.leftTabStop(5736)
      p19.rightTabStop(6636)
      p19.leftTabStop(6836)
      p19.rightTabStop(7736)
      p19.leftTabStop(7936)
      const p19_1 = new TextRun('Angolo di attrito all\'interfaccia GSY/terreno').size(24)
      const p19_2 = new TextRun('δ').size(24).tab().tab().tab()
      const p19_3 = new TextRun(delta.toFixed(2)).bold().size(24).tab().tab()
      const p19_4 = new TextRun('°').size(24).tab()
      p19.addRun(p19_1)
      p19.addRun(p19_2)
      p19.addRun(p19_3)
      p19.addRun(p19_4)
      doc.addParagraph(p19)

      const p20 = new Paragraph()
      p20.rightTabStop(5536)
      p20.leftTabStop(5736)
      p20.rightTabStop(6636)
      p20.leftTabStop(6836)
      p20.rightTabStop(7736)
      p20.leftTabStop(7936)
      const p20_1 = new TextRun('').size(24)
      const p20_2 = new TextRun('tan(δ)').size(24).tab().tab().tab()
      const p20_3 = new TextRun(tan(rad(delta)).toFixed(2)).bold().size(24).tab().tab()
      const p20_4 = new TextRun('').size(24).tab()
      p20.addRun(p20_1)
      p20.addRun(p20_2)
      p20.addRun(p20_3)
      p20.addRun(p20_4)
      doc.addParagraph(p20)

      const p21 = new Paragraph()
      p21.rightTabStop(5536)
      p21.leftTabStop(5736)
      p21.rightTabStop(6636)
      p21.leftTabStop(6836)
      p21.rightTabStop(7736)
      p21.leftTabStop(7936)
      const p21_1 = new TextRun('Resistenza a trazione nominale del rinforzo').size(24)
      const p21_2 = new TextRun('T').size(24).tab().tab().tab()
      const p21_2_1 = new TextRun('_nom').size(24).subScript()
      const p21_3 = new TextRun(t_nom.toFixed(2)).bold().size(24).tab().tab()
      const p21_4 = new TextRun('kN/m').size(24).tab()
      p21.addRun(p21_1)
      p21.addRun(p21_2)
      p21.addRun(p21_2_1)
      p21.addRun(p21_3)
      p21.addRun(p21_4)
      doc.addParagraph(p21)

      const p22 = new Paragraph()
      p22.rightTabStop(5536)
      p22.leftTabStop(5736)
      p22.rightTabStop(6636)
      p22.leftTabStop(6836)
      p22.rightTabStop(7736)
      p22.leftTabStop(7936)
      const p22_1 = new TextRun('Fattore di sicurezza sul danneggiamento').size(24)
      const p22_2 = new TextRun('FS').size(24).tab().tab().tab()
      const p22_2_1 = new TextRun('1').size(24).subScript()
      const p22_3 = new TextRun(fs1.toFixed(1)).bold().size(24).tab().tab()
      const p22_4 = new TextRun('').size(24).tab()
      p22.addRun(p22_1)
      p22.addRun(p22_2)
      p22.addRun(p22_2_1)
      p22.addRun(p22_3)
      p22.addRun(p22_4)
      doc.addParagraph(p22)

      const p23 = new Paragraph()
      p23.rightTabStop(5536)
      p23.leftTabStop(5736)
      p23.rightTabStop(6636)
      p23.leftTabStop(6836)
      p23.rightTabStop(7736)
      p23.leftTabStop(7936)
      const p23_1 = new TextRun('Fattore di sicurezza sul creep').size(24)
      const p23_2 = new TextRun('FS').size(24).tab().tab().tab()
      const p23_2_1 = new TextRun('2').size(24).subScript()
      const p23_3 = new TextRun(fs2.toFixed(1)).bold().size(24).tab().tab()
      const p23_4 = new TextRun('').size(24).tab()
      p23.addRun(p23_1)
      p23.addRun(p23_2)
      p23.addRun(p23_2_1)
      p23.addRun(p23_3)
      p23.addRun(p23_4)
      doc.addParagraph(p23)
      
      const p24 = new Paragraph()
      p24.rightTabStop(5536)
      p24.leftTabStop(5736)
      p24.rightTabStop(6636)
      p24.leftTabStop(6836)
      p24.rightTabStop(7736)
      p24.leftTabStop(7936)
      const p24_1 = new TextRun('Fattore di sicurezza sui fattori chimici').size(24)
      const p24_2 = new TextRun('FS').size(24).tab().tab().tab()
      const p24_2_1 = new TextRun('3').size(24).subScript()
      const p24_3 = new TextRun(fs3.toFixed(1)).bold().size(24).tab().tab()
      const p24_4 = new TextRun('').size(24).tab()
      p24.addRun(p24_1)
      p24.addRun(p24_2)
      p24.addRun(p24_2_1)
      p24.addRun(p24_3)
      p24.addRun(p24_4)
      doc.addParagraph(p24)

      const p25 = new Paragraph()
      p25.rightTabStop(5536)
      p25.leftTabStop(5736)
      p25.rightTabStop(6636)
      p25.leftTabStop(6836)
      p25.rightTabStop(7736)
      p25.leftTabStop(7936)
      const p25_1 = new TextRun('Fattore di sicurezza sui fattori biologici').size(24)
      const p25_2 = new TextRun('FS').size(24).tab().tab().tab()
      const p25_2_1 = new TextRun('4').size(24).subScript()
      const p25_3 = new TextRun(fs4.toFixed(1)).bold().size(24).tab().tab()
      const p25_4 = new TextRun('').size(24).tab()
      p25.addRun(p25_1)
      p25.addRun(p25_2)
      p25.addRun(p25_2_1)
      p25.addRun(p25_3)
      p25.addRun(p25_4)
      doc.addParagraph(p25)

      const p26 = new Paragraph()
      p26.rightTabStop(5536)
      p26.leftTabStop(5736)
      p26.rightTabStop(6636)
      p26.leftTabStop(6836)
      p26.rightTabStop(7736)
      p26.leftTabStop(7936)
      const p26_1 = new TextRun('Fattore di sicurezza totale').size(24)
      const p26_2 = new TextRun('FS').size(24).tab().tab().tab()
      const p26_2_1 = new TextRun('_tot').size(24).subScript()
      const p26_3 = new TextRun(fs_tot.toFixed(1)).bold().size(24).tab().tab()
      const p26_4 = new TextRun('').size(24).tab()
      p26.addRun(p26_1)
      p26.addRun(p26_2)
      p26.addRun(p26_2_1)
      p26.addRun(p26_3)
      p26.addRun(p26_4)
      doc.addParagraph(p26)

      const p27 = new Paragraph()
      p27.rightTabStop(5536)
      p27.leftTabStop(5736)
      p27.rightTabStop(6636)
      p27.leftTabStop(6836)
      p27.rightTabStop(7736)
      p27.leftTabStop(7936)
      const p27_1 = new TextRun('Resistenza a trazione ammissibile').size(24)
      const p27_2 = new TextRun('T').size(24).tab().tab().tab()
      const p27_2_1 = new TextRun('_amm').size(24).subScript()
      const p27_3 = new TextRun(t_amm.toFixed(1)).bold().size(24).tab().tab()
      const p27_4 = new TextRun('kN/m').size(24).tab()
      p27.addRun(p27_1)
      p27.addRun(p27_2)
      p27.addRun(p27_2_1)
      p27.addRun(p27_3)
      p27.addRun(p27_4)
      doc.addParagraph(p27)

      const p28 = new Paragraph()
      p28.rightTabStop(5536)
      p28.leftTabStop(5736)
      p28.rightTabStop(6636)
      p28.leftTabStop(6836)
      p28.rightTabStop(7736)
      p28.leftTabStop(7936)
      const p28_1 = new TextRun('').size(24)
      const p28_2 = new TextRun('t').size(24).tab().tab().tab()
      const p28_2_1 = new TextRun('p').size(24).subScript()
      const p28_3 = new TextRun(tp.toFixed(1)).bold().size(24).tab().tab()
      const p28_4 = new TextRun('kN').size(24).tab()
      p28.addRun(p28_1)
      p28.addRun(p28_2)
      p28.addRun(p28_2_1)
      p28.addRun(p28_3)
      p28.addRun(p28_4)
      doc.addParagraph(p28)

      const p29 = new Paragraph()
      const p29_1 = new TextRun('Risultati').bold().size(24).break()
      p29.addRun(p29_1)
      doc.addParagraph(p29)

      const p30 = new Paragraph()
      p30.rightTabStop(5536)
      p30.leftTabStop(5736)
      p30.rightTabStop(6636)
      p30.leftTabStop(6836)
      p30.rightTabStop(7736)
      p30.leftTabStop(7936)
      const p30_1 = new TextRun('').size(24)
      const p30_2 = new TextRun('N').size(24).tab().tab().tab()
      const p30_3 = new TextRun(n.toFixed(2)).bold().size(24).tab().tab()
      const p30_4 = new TextRun('').size(24).tab()
      p30.addRun(p30_1)
      p30.addRun(p30_2)
      p30.addRun(p30_3)
      p30.addRun(p30_4)
      doc.addParagraph(p30)

      const p31 = new Paragraph()
      p31.rightTabStop(5536)
      p31.leftTabStop(5736)
      p31.rightTabStop(6636)
      p31.leftTabStop(6836)
      p31.rightTabStop(7736)
      p31.leftTabStop(7936)
      const p31_1 = new TextRun('').size(24)
      const p31_2 = new TextRun('S').size(24).tab().tab().tab()
      const p31_3 = new TextRun(s.toFixed(2)).bold().size(24).tab().tab()
      const p31_4 = new TextRun('').size(24).tab()
      p31.addRun(p31_1)
      p31.addRun(p31_2)
      p31.addRun(p31_3)
      p31.addRun(p31_4)
      doc.addParagraph(p31)

      const p32 = new Paragraph()
      p32.rightTabStop(5536)
      p32.leftTabStop(5736)
      p32.rightTabStop(6636)
      p32.leftTabStop(6836)
      p32.rightTabStop(7736)
      p32.leftTabStop(7936)
      const p32_1 = new TextRun('').size(24)
      const p32_2 = new TextRun('FS').size(24).tab().tab().tab()
      const p32_2_1 = new TextRun('r').size(24).subScript()
      const p32_3 = new TextRun(fsr.toFixed(1)).bold().size(24).tab().tab()
      const p32_4 = new TextRun('').size(24).tab()
      p32.addRun(p32_1)
      p32.addRun(p32_2)
      p32.addRun(p32_2_1)
      p32.addRun(p32_3)
      p32.addRun(p32_4)
      doc.addParagraph(p32)
    }

    saveDocument(doc)
  })()
}

const saveDocument = (doc) => {
  return ((doc) => {
    const packer = new Packer()
    packer.toBlob(doc).then(blob => {
      saveAs(blob, doc.title + '.docx')
    })
  })(doc)
}